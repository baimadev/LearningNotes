
[热修复](#1)   
[插件化](#2) 


<h3 id="1"></h3>

## 热修复
热修复，通过补丁包的方式去修复bug。
原理：

- 打包补丁APK
- 通过DexClassLoader加载dex文件到内存  
DexClassLoader的属性pathList，它里面存放了APP要加载的dex文件数组，将补丁dex插入到数组头部，因为DexClassLoader加载类成功时，会直接返回，便不会加载后面的bug类了。

	- 通过构造一个DexClassLoader对象来加载我们的热更新dex文件；
	- 通过反射获取系统默认的PathClassLoader.pathList.dexElements；  
	- 将我们的热更新dex与系统默认的Elements数组合并，同时保证热更新dex在系统默认Elements数组之前；  
	- 将合并完成后的数组设置回PathClassLoader.pathList.dexElements。


- PathClassLoader本身继承自BaseDexClassLoader，
- BaseDexClassLoader重写了findClass方法，BaseDexClassLoader将findClass方法委托给了pathList对象的findClass方法
- pathList它的类型是DexPathList，它的findclass做的是直接就是遍历dexElements列表，然后通过调用element.dexFile对象上的loadClassBinaryName方法来加载类，如果返回值不是null，就表示加载类成功，会将这个Class对象返回。 

<h3 id="2"></h3>

## 插件化

插件化开发模式，打包时是一个宿主apk+多个插件apk。  
组件化开发模式，打包时是一个apk，里面分多个module。

Activity插件化原理（一种方式）：

- 宿主App预留占坑Activity
- 使用classLoader加载dex文件到内存
- 先使用占坑Activity绕过AMS验证（使用hook给Intent添加插件Activity的信息），然后在主线程的handle处理startActivity时，通过hook的方式替换插件Activity。

