# Compose
Compose是一个适用于Android的声明式UI工具库。

## 何为声明式UI？
简单来说其工作原理就是状态更新时，从头开始重新生成整个屏幕界面，然后仅执行必要的更改。此方法可避免手动更新有状态视图层次结构的复杂性。  

重新生成整个屏幕同时也带来一些问题：事件、计算能力、电池用量等成本高昂。  

Compose为减轻这些性能消耗，会智能的选择重绘界面哪些部分，当然也不完全智能，还是得依靠规范的编码和组件设计。

## 举个栗子

```java

@Compose
fun HelloWorld(name:String){
  Text("Hello $name")
}

```

 - 所有可组合函数都必须带有@Compose，告知编译器这是个界面组件
 - Text()也是个可组合函数，可组合函数通过调用其他可组合函数来发出界面层次结构。
 - 可组合函数不需要返回任何内容，它们只是用来声明界面的状态。
 - 此函数快速、**幂等**，且没有**副作用**。

幂等：指可以使用相同参数重复执行，并能获得相同结果的函数，不会因为某些状态的变化而结果发生变化。

无副作用：该函数应该是个纯函数，不应修改程序的状态或修改全局变量。

 ### 为什么会有这些要求？
 
 - （1）、可组合函数会按任何顺序执行；
 - （2）、可组合函数可以并行运行，可能会同事从多个线程调用函数；
 - （3）、重组会跳过尽可能多的内容，只会去重组值发生变化的控件。
 - （4）、重组是乐观操作，如果某个参数在重组完成之前发生更改，Compose 可能会取消重组，并使用新参数重新开始。
 - （5）、可组合函数可能会非常频繁的运行；
 在某些情况下，可能会针对界面动画的每一帧运行一个可组合函数。如果该函数执行成本高昂的操作（例如从设备存储空间读取数据），可能会导致界面卡顿。

## 状态控制

可组合函数是相对无状态的，那么我们怎么去控制界面状态的刷新了？  
这就得使用ViewModel+State去进行界面状态的控制。可组合函数在每次可观察数据更新时会触发重组更新界面。

![state](../img/compose_state)
